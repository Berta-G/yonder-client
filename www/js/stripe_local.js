// Generated by CoffeeScript 1.7.1
var handleStripe, onStripeSuccess, stripeResponseHandler;

Stripe.setPublishableKey('pk_test_lJZQxPeri5h1HdFfsQFAmF6A');

stripeResponseHandler = function(status, response) {
  var $form, cookie, data, token;
  $form = $('#stripe-form');
  if (response.error) {
    $form.find('.payment-errors').text(response.error.message);
    return $form.find('button').prop('disabled', false);
  } else {
    token = response.id;
    $form.append($('<input type="hidden" name="stripeToken" />').val(token));
    cookie = JSON.parse(window.localStorage.getItem("business"));
    $form.append($('<input type="hidden" name="business-id" />').val(cookie.business.id));
    data = $form.serializeArray();
    return $.post("http:scupr-staging.herokuapp.com/payment", data, onStripeSuccess);
  }
};

handleStripe = function() {
  var $form;
  event.preventDefault();
  $form = $('#stripe-form');
  $form.find('button').prop('disabled', true);
  Stripe.card.createToken($form, stripeResponseHandler);
  return false;
};

onStripeSuccess = function(data) {
  window.localStorage.setItem("business", JSON.stringify(data));
  navigator.notification.alert("Radius successfully updated", getBucketWithGPS(), "Payment Details");
  return getBucketWithGPS();
};
